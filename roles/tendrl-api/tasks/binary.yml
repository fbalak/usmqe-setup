- name: Install tendrl-api without allowed epel
  yum:
    name=tendrl-api
    state=latest
  when:
    not use_epel
    
- name: Install tendrl-api with allowed epel
  yum:
    name=tendrl-api
    state=latest
    enablerepo=epel
  when:
    use_epel

- name: Install tendrl-api-httpd without allowed epel
  yum:
    name=tendrl-api-httpd
    state=latest
  when:
    not use_epel
    
- name: Install tendrl-api-httpd with allowed epel
  yum:
    name=tendrl-api-httpd
    state=latest
    enablerepo=epel
  when:
    use_epel

- name: Install tendrl-api-doc without allowed epel
  yum:
    name=tendrl-api-doc
    state=latest
  when:
    not use_epel
    
- name: Install tendrl-api-doc with allowed epel
  yum:
    name=tendrl-api-doc
    state=latest
    enablerepo=epel
  when:
    use_epel
    
- name: Configure etcd.yml - host
  lineinfile:
    dest=/etc/tendrl/etcd.yml
    regexp="^  {{ ":" }}host{{ ":" }} \'127.0.0.1\'"
    line="  {{ ":" }}{{ item }}{{ ":" }} \'{{ hostvars[groups['usm_server'][0]]['ansible_eth0']['ipv4']['address'] }}\'"
  with_items:
    - host
    - host
    - host
